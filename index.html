<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LTV Matrix Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f9f9f9;
      transition: background 0.3s, color 0.3s;
    }
    h1 {
      margin-bottom: 10px;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input {
      padding: 6px;
      width: 100px;
      margin-top: 5px;
    }
    .highlight {
      font-weight: bold;
      color: #007700;
    }
    table {
      margin-top: 20px;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px 12px;
      text-align: center;
    }
    .profitable {
      background-color: #d4f7d4;
    }
    .cell-sub {
      font-size: 0.75em;
      color: #444;
    }
    .min-highlight {
      background-color: #ffe599 !important;
      border: 2px solid #f1b300;
    }
    details {
      background: #fff;
      padding: 15px;
      margin-bottom: 20px;
      border-left: 4px solid #0077cc;
    }
    summary {
      font-weight: bold;
      cursor: pointer;
      font-size: 16px;
    }
    .dark {
      background: #1e1e1e;
      color: #f0f0f0;
    }
    .dark table th, .dark table td {
      border-color: #555;
    }
    .dark .highlight {
      color: #00cc66;
    }
    .dark .profitable {
      background-color: #2d5f2d;
    }
    .dark .cell-sub {
      color: #aaa;
    }
    .dark .min-highlight {
      background-color: #866d00 !important;
      border-color: #ffd700;
    }
    button.toggle-theme {
      margin-top: 10px;
      padding: 5px 10px;
    }
    button.export-html {
      margin-top: 10px;
      padding: 5px 12px;
    }
  </style>
</head>
<body>
  <h1>LTV Profitability Matrix</h1>

  <button class="toggle-theme" onclick="toggleTheme()">üåô –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É</button>
  <button class="export-html" onclick="exportHTML()">üì• –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ HTML</button>

  <details>
    <summary>–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —ç—Ç–æ–π —Ç–∞–±–ª–∏—Ü–µ–π?</summary>
    <p>–≠—Ç–∞ —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–Ω—è—Ç—å, –ø—Ä–∏ –∫–∞–∫–∏—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏—è—Ö –∫–æ–Ω–≤–µ—Ä—Å–∏–π –∏ LTV –ø–æ–¥–ø–∏—Å–∫–∏ —ç–∫–æ–Ω–æ–º–∏–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∞ –±—É–¥–µ—Ç —Å—Ö–æ–¥–∏—Ç—å—Å—è.</p>
    <ul>
      <li><strong>CPI</strong> ‚Äî —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏</li>
      <li><strong>LTV –ø–æ–¥–ø–∏—Å–∫–∏</strong> ‚Äî —Å–∫–æ–ª—å–∫–æ –≤ —Å—Ä–µ–¥–Ω–µ–º –ø—Ä–∏–Ω–æ—Å–∏—Ç –æ–¥–∏–Ω –ø–ª–∞—Ç—è—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</li>
      <li><strong>Trial Start Rate</strong> (–ø–æ —Å—Ç—Ä–æ–∫–∞–º) ‚Äî % —É—Å—Ç–∞–Ω–æ–≤–æ–∫, –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö —Ç—Ä–∏–∞–ª</li>
      <li><strong>Trial Conversion Rate</strong> (–ø–æ —Å—Ç–æ–ª–±—Ü–∞–º) ‚Äî % —Ç—Ä–∏–∞–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–∞–ª–∏ –ø–ª–∞—Ç—è—â–∏–º–∏</li>
      <li><strong>–ó–Ω–∞—á–µ–Ω–∏—è –≤ —è—á–µ–π–∫–∞—Ö</strong> ‚Äî LTV per Install –∏ –∏—Ç–æ–≥–æ–≤–∞—è –∫–æ–Ω–≤–µ—Ä—Å–∏—è install ‚Üí paid</li>
      <li><strong>–ó–µ–ª—ë–Ω—ã–π —Ü–≤–µ—Ç</strong> ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏—Ç–Ω–∞—è (LTV ‚â• CPI)</li>
      <li><strong>–ñ—ë–ª—Ç–∞—è —è—á–µ–π–∫–∞</strong> ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–æ—Ñ–∏—Ç–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è</li>
    </ul>
    <p>–¢–∞–∫–∂–µ –Ω–∏–∂–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è:</p>
    <ul>
      <li>–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞—è –∫–æ–Ω–≤–µ—Ä—Å–∏—è install ‚Üí paid</li>
      <li>–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π LTV –ø–æ–¥–ø–∏—Å–∫–∏, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –º–æ–∂–Ω–æ –≤—ã–π—Ç–∏ –≤ –Ω–æ–ª—å</li>
    </ul>
  </details>

  <label>CPI ($): <input id="cpi" type="number" step="0.01" value="2"></label>
  <label>LTV per Paying User ($): <input id="ltvPayer" type="number" step="0.1" value="60"></label>

  <div style="margin-top: 10px;" id="resultText"></div>
  <div style="margin-top: 5px;" id="minLtvRequired"></div>

  <table id="matrix"></table>

  <script>
    const cpiInput = document.getElementById('cpi');
    const ltvPayerInput = document.getElementById('ltvPayer');
    const matrixEl = document.getElementById('matrix');
    const resultText = document.getElementById('resultText');
    const minLtvRequired = document.getElementById('minLtvRequired');

    function updateMatrix() {
      const cpi = parseFloat(cpiInput.value);
      const ltvPayer = parseFloat(ltvPayerInput.value);

      const startRates = [5,10,15,20,25,30,35,40,45,50];
      const convRates = [5,10,15,20,25,30,35,40,45,50];

      let html = '<tr><th>Trial Start %</th>';
      convRates.forEach(cr => html += `<th>${cr}%</th>`);
      html += '</tr>';

      let foundProfitable = false;
      let minEffectiveConv = null;
      let minRow = -1, minCol = -1;

      startRates.forEach((sr, rowIdx) => {
        html += `<tr><th>${sr}%</th>`;
        convRates.forEach((cr, colIdx) => {
          const installConv = sr / 100 * cr / 100;
          const ltv = installConv * ltvPayer;
          const isProfitable = ltv >= cpi;
          let cellClass = "";

          if (isProfitable) {
            if (!foundProfitable || installConv < minEffectiveConv) {
              foundProfitable = true;
              minEffectiveConv = installConv;
              minRow = rowIdx;
              minCol = colIdx;
            }
            cellClass = 'profitable';
          }

          html += `<td data-row="${rowIdx}" data-col="${colIdx}" class="${cellClass}">${ltv.toFixed(2)}<div class='cell-sub'>${(installConv * 100).toFixed(2)}%</div></td>`;
        });
        html += '</tr>';
      });

      matrixEl.innerHTML = html;

      if (foundProfitable) {
        const table = matrixEl.querySelectorAll("tr");
        const minCell = table[minRow + 1].children[minCol + 1];
        minCell.classList.add("min-highlight");
      }

      resultText.innerHTML = `CPI: <span class="highlight">$${cpi.toFixed(2)}</span>, LTV –ø–æ–¥–ø–∏—Å–∫–∏: <span class="highlight">$${ltvPayer.toFixed(2)}</span>`;

      if (minEffectiveConv !== null) {
        const percent = (minEffectiveConv * 100).toFixed(2);
        const minLtv = cpi / minEffectiveConv;
        minLtvRequired.innerHTML = `–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Å–∏—è install ‚Üí paid: <span class="highlight">${percent}%</span><br>–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–π LTV –ø–æ–¥–ø–∏—Å–∫–∏: <span class="highlight">$${minLtv.toFixed(2)}</span>`;
      } else {
        minLtvRequired.innerHTML = '<span class="highlight">–ù–µ—Ç –ø—Ä–æ—Ñ–∏—Ç–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π</span>';
      }
    }

    function toggleTheme() {
      document.body.classList.toggle('dark');
    }

    function exportHTML() {
      const blob = new Blob([document.documentElement.outerHTML], {type: "text/html"});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = "ltv_matrix_calculator.html";
      a.click();
    }

    cpiInput.addEventListener('input', updateMatrix);
    ltvPayerInput.addEventListener('input', updateMatrix);
    updateMatrix();
  </script>
</body>
</html>
